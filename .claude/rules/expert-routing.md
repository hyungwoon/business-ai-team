# 전문가 라우팅 시스템

## 활성화 조건

이 규칙은 다음 중 하나라도 해당할 때 적용된다:
1. 현재 프로젝트에 `agents/` 폴더가 존재할 때 (로컬 모드)
2. `~/.claude/business-team/agents/` 폴더가 존재할 때 (글로벌 모드)

둘 다 없는 프로젝트(순수 코딩 프로젝트이면서 글로벌 설치도 안 된 경우)에서는 이 규칙 전체를 무시한다.

## 경로 탐색 원칙 (로컬 우선, 글로벌 폴백)

에이전트/스킬 파일 참조 시 다음 순서를 따른다:

1. **로컬 확인**: 현재 프로젝트에 `agents/` 폴더가 존재하면 → `agents/`, `plugins/` 경로 사용
2. **글로벌 폴백**: 로컬에 없으면 → `~/.claude/business-team/agents/`, `~/.claude/business-team/plugins/` 경로 사용

이하 문서에서 `agents/`, `plugins/`는 위 규칙에 따라 결정된 실제 경로를 의미한다.

## 비즈니스 요청 라우팅 (MANDATORY — 절대 생략 불가)

> **이 규칙은 모든 응답 규칙 중 최우선이다. 비즈니스 도메인 요청에 응답하기 전에 반드시 실행해야 하며, 어떠한 이유로도 건너뛸 수 없다.**

### 라우팅 강제 절차

비즈니스 도메인 요청(마케팅, 영업, 리서치, 재무, 법률, 제품, 데이터, HR, PR, 보안, 디자인, 사업개발, 컴플라이언스, 생산성, 문서작성 등)을 받으면:

1. **도메인 분류** — 요청이 어떤 에이전트 도메인에 해당하는지 판단
   - CLAUDE.md에 에이전트 매핑 테이블이 있으면 참조
   - 없으면 `agents/*.md` 파일의 첫 줄 설명(> 인용문)으로 판단
2. **에이전트 파일 읽기 (필수)** — `agents/[에이전트명].md`를 Read 도구로 실제 읽기
3. **스킬 파일 읽기 (필수)** — 에이전트 파일의 "플러그인 & 스킬 라우팅" 섹션에서 관련 스킬 확인 후, `plugins/[플러그인]/skills/[스킬]/SKILL.md`를 Read 도구로 실제 읽기
4. **전문가 관점 적용** — 에이전트 시스템 프롬프트 + 스킬 베스트 프랙티스 반영하여 응답
5. **담당 표시 (필수)** — 응답 맨 앞에 `> **담당**: [에이전트] | 참조 스킬: [스킬]`

### 금지 사항

- **절대 금지**: 에이전트 .md 파일을 읽지 않고 비즈니스 응답 생성
- **절대 금지**: SKILL.md를 읽지 않고 도메인 전문 지식 응답 생성
- **절대 금지**: `> **담당**:` 표시 없이 비즈니스 응답 전달
- **절대 금지**: 기억이나 추정으로 에이전트 지식 대체 — 항상 파일에서 직접 읽기

### 라우팅 예외 (이 경우에만 생략 가능)

- 일반 대화 (인사, 잡담)
- 시스템/코드 관련 작업 (git, 파일 편집, 디버깅)
- CLAUDE.md 자체에 대한 질문

### 응답 담당 표시 형식

비즈니스 요청에 응답할 때, **본문 맨 앞에** 어떤 에이전트가 참여했는지 표시한다:

- 단일 에이전트: `> **담당**: Marketing | 참조 스킬: content-creation`
- 복합 에이전트: `> **담당**: Research + Product + Marketing | 참조 스킬: competitive-analysis, feature-spec, campaign-planning`
- 일반 대화(비즈니스 도메인 아님): 표시 생략

### 라우팅 원칙

- **단일 도메인 요청**: 해당 에이전트 1개의 시스템 프롬프트 + 플러그인 스킬 참조
- **복합 도메인 요청**: 주 에이전트의 관점을 중심으로, 보조 에이전트의 전문성 보충
- **플러그인 스킬은 필요 시에만**: 모든 스킬을 매번 읽지 않고, 요청과 직접 관련된 스킬만 선택적으로 로드
- **에이전트 문서가 진실의 원천**: CLAUDE.md의 매핑은 라우팅 가이드일 뿐, 실제 시스템 프롬프트와 스킬 내용은 항상 파일에서 직접 읽기

## 에이전트 지식 관리 원칙

- `agents/*.md`의 시스템 프롬프트는 각 도메인의 전문 지식 원천
- `plugins/*/skills/*/SKILL.md`는 도메인별 베스트 프랙티스
- 에이전트 문서 수정 시 해당 도메인의 전문성이 CLI 세션에도 자동 반영됨
- 새 도메인 추가 시: 에이전트 .md 생성 + 플러그인 스킬 추가 + CLAUDE.md 매핑 테이블 갱신
- 항상 파일에서 직접 읽기, 기억이나 추정 금지

## 디렉토리 구조 확인 원칙

> **파일 경로를 추정하지 마라. 반드시 확인하라.**

- **프로젝트 폴더 작업 시**: 파일에 접근하기 전에 `ls`로 디렉토리 구조를 **반드시** 먼저 확인
- **파일명만 알고 있는 경우**: 파일이 서브폴더에 있을 수 있으므로 경로를 추정하지 않고 `ls` 또는 `Glob`으로 실제 위치 확인
- **"파일이 없다"고 보고하기 전에**: 서브폴더까지 탐색했는지 재확인 — 플랫 경로 실패 시 `Glob`으로 재검색

**금지 사항**:
- **절대 금지**: `ls` 없이 파일 경로를 추정하여 접근
- **절대 금지**: 파일을 못 찾았을 때 서브폴더 탐색 없이 "없다"고 보고

## 새 프로젝트 설정 가이드

에이전트 팀 시스템을 새 프로젝트에 적용할 때 필요한 최소 구조:

```
프로젝트/
├── CLAUDE.md       ← 프로젝트 개요 + 에이전트 매핑 테이블 (선택)
├── agents/         ← 에이전트 .md 파일 (필수)
└── plugins/        ← SKILL.md 파일 (선택)
```

또는 글로벌 설치를 통해 모든 프로젝트에서 사용 가능:

```bash
# business-ai-team 프로젝트에서
./install.sh
```

CLAUDE.md 최소 내용:
```markdown
## 프로젝트 개요
[프로젝트 설명]

## 에이전트 매핑 테이블 (선택 — 없으면 agents/*.md 자동 스캔)
| 키워드 | 에이전트 | 파일 |
|---|---|---|
| ... | ... | agents/... |
```
